Analisis de datos
========================================================





```{r directorio}

directorio <- "C:\\Users\\Patatas\\Desktop\\ea1-pr"
setwd(directorio)

```



### Librerias utilizadas
```{r Librerias, results = 'hide'}
paquetes.utilizados <- c("reshape2", "tidyr", "xtable", "knitr", "qdap",
                         "dplyr", "plyr", "lubridate", "ggplot2", "openxlsx")
paquetes.instalados <- rownames(installed.packages())
paquetes.por.instalar <- setdiff(paquetes.utilizados, paquetes.instalados)

# Instala los paquetes faltantes.
if (length(paquetes.por.instalar) != 0 ) install.packages(paquetes.por.instalar, 
                                                          repos = "http://cran.us.r-project.org")
# Carga los paquetes a utilizar.
lapply(paquetes.utilizados, library, character.only = TRUE)
```


```{r  lectura}
setwd("./DATOS/BRUTOS/csv")
nombres <- list.files(pattern= "*.csv")
for (i in 1:length(nombres)){
  assign( substr(nombres[i], 1, nchar(nombres[i])-4), read.csv(nombres[i],stringsAsFactors=FALSE))
}

```

```{r nombres}
nombres_sin <- nombres
for (i in 1:length(nombres)){
  nombres_sin[i] <- substr(nombres[i], 1, nchar(nombres[i])-4)
}

```



```{r melt }

for (i in 1:33){
  assign(nombres_sin[i], melt (data = get(nombres_sin[i]), variable.name ="fuente", value.name= "observaciones", id =1))
  
}



for (i in 34:66){
  assign(nombres_sin[i], melt (data = get(nombres_sin[i]), variable.name ="grupo", value.name= "observaciones", id =1))
  
}

## corregir por incidencia, tasa
for (i in 67:99){
  assign(nombres_sin[i], melt (data = get(nombres_sin[i]), variable.name ="mes", value.name= "observaciones", id =1))
  
}

```






```{r agregar columnas}
## agregar aÃ±o

for (i in 1:99){
  t <- unlist(nombres_sin[i])
  tdf <- get(unlist(nombres_sin[i])) 
  assign(unlist(nombres_sin[i]), data.frame(tdf, aÃ±o = as.integer(substr(t,5,8))))
  
}


##agregar genero

for (i in 1:99){
  t <- unlist(nombres_sin[i])
  tdf <- get(unlist(nombres_sin[i])) 
  gen <- substr(t,3,3)
  if(gen == "f"){
    gen_n <- "femenino"
  }else{
    if(gen == "m"){
      gen_n <- "masculino"
    }else{
      if(gen == "g"){
        gen_n <- "general"
      }
    }
  }
  assign(unlist(nombres_sin[i]), data.frame(tdf, genero = gen_n))  
  
}

```



```{r unir en tres tablas}
## por fuente 
fuente <- rbind(get(unlist(nombres_sin[1])),get(unlist(nombres_sin[2])))
for(i in 3:33){
  fuente <- rbind(get(unlist(nombres_sin[i])),fuente)
  
}

## por grupo 
grupo <- rbind(get(unlist(nombres_sin[34])),get(unlist(nombres_sin[35])))
for(i in 36:66){
  grupo <- rbind(get(unlist(nombres_sin[i])),grupo)
  
}

## por mes 
mes <- rbind(get(unlist(nombres_sin[67])),get(unlist(nombres_sin[68])))
for(i in 69:99){
  mes <- rbind(get(unlist(nombres_sin[i])),mes)
  
}
```




```{r limpieza}
###limpieza fuente: nombres de estados repetidos eliminados, reclasificacion de columnas
##numero
estados <- list("Aguascalientes","Baja California","Baja California Sur","Campeche","Coahuila","Colima","Chiapas","Chihuahua","Distrito Federal","Durango","Guanajuato","Guerrero","Hidalgo","Jalisco","MÃ©xico","MichoacÃ¡n","Morelos","Nayarit","Nuevo LeÃ³n","Oaxaca","Puebla","QuerÃ©taro","Quintana Roo","San Luis PotosÃ­","Sinaloa","Sonora","Tabasco","Tamaulipas","Tlaxcala","Veracruz","YucatÃ¡n","Zacatecas")

fuente <- within(fuente,{
                         observaciones  <- gsub(" ","", observaciones)
                         observaciones <- as.integer(observaciones)
                         for (i in 1:32){
                           Estado <- gsub(paste0(unlist(estados[i])," "),unlist(estados[i]), Estado)
                           
                         }
                         Estado <- gsub("Baja CaliforniaSur","Baja California Sur",Estado)
                         Estado <- gsub("Baja CaliforniaSu","Baja California Sur",Estado)
                         Estado <- gsub("Baja California Sur ","Baja California Sur",Estado)
                         Estado <- gsub("San Luis Potosi","San Luis PotosÃ­",Estado)
                         Estado <- as.factor(Estado)
                         fuente <- gsub("InstituciÃ³n............................................................................................DIF","DIF", fuente)
                         fuente <- gsub("Otras","OTRAS", fuente)
                         fuente <- gsub("Salud", "SALUD", fuente)
                         fuente <- gsub("SEDEMAR", "SEMAR", fuente)
                         fuente <- gsub("SALUD", "SSA", fuente)
                         fuente <- gsub("IMSS.ORD","IMMS",fuente)
                         fuente <- gsub("IMSS.OP","IMMS",fuente)
                         fuente <- gsub("IMSS.Ord","IMMS",fuente)
                         fuente <- gsub("IMSS.Op","IMMS",fuente)
                         fuente <- as.factor(fuente)

                    }
                    )
fuente <- subset (fuente, select= 1:5)##corregir columna agredada (i=32)
                         
## por grupo



grupo <- within(grupo,{
                       Estado <- gsub("Baja California  Sur","Baja California Sur",Estado)
                       Estado <- gsub("San Luis Potosi","San Luis PotosÃ­",Estado)
                       Estado <- as.factor(Estado)
                       observaciones  <- gsub(" ","", observaciones)
                       observaciones <- as.integer(observaciones)
                       grupo <- gsub("x","",grupo)  
                       grupo <- gsub("X","",grupo) 
                       grupo <- gsub("abr","4",grupo)
                       grupo <- gsub("sep","9",grupo)
                       grupo <- gsub("abr","4",grupo)
                       grupo <- gsub("y","",grupo)
                       grupo <- gsub("oct","10",grupo)
                       grupo <- gsub("01","1",grupo)
                       grupo <- gsub("05","5",grupo)
                       grupo <- gsub("1.4","1...4",grupo)     
                       grupo <- gsub("10.14","10...14",grupo) 
                       grupo <- gsub("5.9","5...9",grupo) 
                       grupo <- gsub("..1","...1",grupo) 
                       grupo <- gsub("[.]","-",grupo) 
                       grupo <- gsub("-19","19",grupo)
                       grupo <- gsub("-14","14",grupo)

                       grupo <- gsub("Ign-","desconocido",grupo)
                    }
                    )
grupo$grupo <- as.factor(grupo$grupo)





### por mes

Mes <- list("Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre")

mes <- within(mes,{
                         observaciones  <- gsub(" ","", observaciones)
                         observaciones <- as.integer(observaciones)
                         for (i in 1:32){
                            Estado <- gsub(paste0(unlist(estados[i])," "),unlist(estados[i]), Estado)
                         }
                         Estado <- gsub("Baja CaliforniaSur","Baja California Sur",Estado)
                         Estado <- gsub("Baja CaliforniaSu","Baja California Sur",Estado)
                         Estado <- gsub("Baja California Sur ","Baja California Sur",Estado)
                         Estado <- gsub("San Luis Potosi","San Luis PotosÃ­­",Estado)
                         Estado<-gsub("San Luis PotosÃ­ ","San Luis PotosÃ­",Estado)
                         Estado<-gsub("MÃ©xico ","MÃ©xico",Estado)
                         Estado<-gsub("MichoacÃ¡n ","MichoacÃ¡n",Estado)
                         Estado<-gsub("Nuevo LeÃ³n ","Nuevo LeÃ³n",Estado)
                         Estado<-gsub("YucatÃ¡n ","YucatÃ¡n",Estado)
                         Estado<-gsub("Queretaro","QuerÃ©taro",Estado)
                         Estado<-gsub("San Luis Poto.*","San Luis PotosÃ­",Estado)
                     
                         Estado <- as.factor(Estado)
                         mes<-gsub("Ene.*","Enero",mes)
                         mes<-gsub("Feb.*","Febrero",mes)
                         mes<-gsub("Mar.*","Marzo",mes) 
                         mes<-gsub("Abr.*","Abril",mes)
                         mes<-gsub("May.*","Mayo",mes)
                         mes<-gsub("Jun.*","Junio",mes)
                         mes<-gsub("Jul.*","Julio",mes)
                         mes<-gsub("Ago.*","Agosto",mes)
                         mes<-gsub("Sep.*","Septiembre",mes)
                         mes<-gsub("Oct.*","Octubre",mes)
                         mes<-gsub("Nov.*","Noviembre",mes)
                         mes<-gsub("Dic.*","Diciembre",mes)
                         mes<-gsub("ENE.*","Enero",mes)
                         mes<-gsub("FEB.*","Febrero",mes)
                         mes<-gsub("MAR.*","Marzo",mes) 
                         mes<-gsub("ABR.*","Abril",mes)
                         mes<-gsub("MAY.*","Mayo",mes)
                         mes<-gsub("JUN.*","Junio",mes)
                         mes<-gsub("JUL.*","Julio",mes)
                         mes<-gsub("AGO.*","Agosto",mes)
                         mes<-gsub("SEP.*","Septiembre",mes)
                         mes<-gsub("OCT.*","Octubre",mes)
                         mes<-gsub("NOV.*","Noviembre",mes)
                         mes<-gsub("DIC.*","Diciembre",mes)
                         mes<-as.factor(mes)
                    }
                    )


mes <- subset (mes, select= 1:5) 
                

```






```{r}


```


