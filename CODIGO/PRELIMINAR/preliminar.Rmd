Analisis de datos
========================================================





```{r}

directorio <- "C:\\Users\\Patatas\\Desktop\\ea1-pr"
setwd(directorio)

```



### Librerias utilizadas
```{r Librerias, results = 'hide'}
paquetes.utilizados <- c("reshape2", "tidyr", "xtable", "knitr", "qdap",
                         "dplyr", "plyr", "lubridate", "ggplot2", "openxlsx")
paquetes.instalados <- rownames(installed.packages())
paquetes.por.instalar <- setdiff(paquetes.utilizados, paquetes.instalados)

# Instala los paquetes faltantes.
if (length(paquetes.por.instalar) != 0 ) install.packages(paquetes.por.instalar, 
                                                          repos = "http://cran.us.r-project.org")
# Carga los paquetes a utilizar.
lapply(paquetes.utilizados, library, character.only = TRUE)
```


```{r  lectura}
setwd("./DATOS/BRUTOS/csv")
nombres <- list.files(pattern= "*.csv")
for (i in 1:length(nombres)){
  assign( substr(nombres[i], 1, nchar(nombres[i])-4), read.csv(nombres[i]))
}

```

```{r nombres}
nombres_sin <- nombres
for (i in 1:length(nombres)){
  nombres_sin[i] <- substr(nombres[i], 1, nchar(nombres[i])-4)
}

```

```{r melt }

for (i in 1:33){
  assign(nombres_sin[i], melt (data = read.csv(nombres[i]), na.rm=TRUE, variable.name ="fuente", value.name= "numero", id =1))
  
}



for (i in 33:66){
  assign(nombres_sin[i], melt (data = read.csv(nombres[i]), na.rm=TRUE, variable.name ="Grupo de edad", value.name= "Observación", id =1))
  
}


for (i in 66:99){
  assign(nombres_sin[i], melt (data = read.csv(nombres[i]), na.rm=TRUE, variable.name ="Mes de daño", value.name= "Observación", id =1))
  
}

```






```{r agregar columnas}
## agregar año

for (i in 1:99){
  t <- unlist(nombres_sin[i])
  tdf <- get(unlist(nombres_sin[i])) 
  assign(unlist(nombres_sin[i]), data.frame(tdf, año = as.integer(substr(t,5,8))))
  
}


##agregar genero

for (i in 1:99){
  t <- unlist(nombres_sin[i])
  tdf <- get(unlist(nombres_sin[i])) 
  gen <- substr(t,3,3)
  if(gen == "f"){
    gen_n <- "femenino"
  }else{
    if(gen == "m"){
      gen_n <- "masculino"
    }else{
      if(gen == "g"){
        gen_n <- "general"
      }
    }
  }
  assign(unlist(nombres_sin[i]), data.frame(tdf, genero = gen_n))  
  
}

```



```{r unir en tres tablas}
## por fuente 
fuente <- rbind(get(unlist(nombres_sin[1])),get(unlist(nombres_sin[2])))
for(i in 3:33){
  fuente <- rbind(get(unlist(nombres_sin[i])),fuente)
  
}

## por grupo 
grupo <- rbind(get(unlist(nombres_sin[34])),get(unlist(nombres_sin[35])))
for(i in 36:66){
  grupo <- rbind(get(unlist(nombres_sin[i])),grupo)
  
}




```


